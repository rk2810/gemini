#
# Device        : Xiaomi Mi 5 (gemini)
# Maintainer    : MOVZX (MOVZX@Telegram.org)
#

on darkness
    # Bring all CPU Cores to online
        write /sys/devices/system/cpu/cpu0/online 1
        write /sys/devices/system/cpu/cpu1/online 1
        write /sys/devices/system/cpu/cpu2/online 1
        write /sys/devices/system/cpu/cpu3/online 1
    #
    # Disable Thermal & BCL Hotplug
        write /sys/module/msm_thermal/core_control/enabled 0
        write /sys/devices/soc/soc:qcom,bcl/mode "disable"
        write /sys/devices/soc/soc:qcom,bcl/hotplug_mask 0
        write /sys/devices/soc/soc:qcom,bcl/hotplug_soc_mask 0
        write /sys/devices/soc/soc:qcom,bcl/mode "enable"
    #
    # Set CPU Parameters
        # Little
            write /sys/devices/system/cpu/cpu0/online 1
            write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 307200
            # Darkness
            write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "darkness"
            write /sys/devices/system/cpu/cpu0/cpufreq/darkness/go_hispeed_load 85
            write /sys/devices/system/cpu/cpu0/cpufreq/darkness/timer_rate 20000
            write /sys/devices/system/cpu/cpu0/cpufreq/darkness/min_sample_time 21000
            write /sys/devices/system/cpu/cpu0/cpufreq/darkness/max_freq_hysteresis 0
            write /sys/devices/system/cpu/cpu0/cpufreq/darkness/timer_slack 80000
            write /sys/devices/system/cpu/cpu0/cpufreq/darkness/hispeed_freq 1228800
            write /sys/devices/system/cpu/cpu0/cpufreq/darkness/above_hispeed_delay "13000 1228800:21000"
            write /sys/devices/system/cpu/cpu0/cpufreq/darkness/target_loads "1 307200:10 480000:20 652800:30 844800:40 960000:50 1036800:60 1113600:70 1190400:80 1228800:90 1363200:95"
            write /sys/devices/system/cpu/cpu0/cpufreq/darkness/use_migration_notif 1
            write /sys/devices/system/cpu/cpu0/cpufreq/darkness/use_sched_load 0
            write /sys/devices/system/cpu/cpu0/cpufreq/darkness/align_windows 1
            write /sys/devices/system/cpu/cpu0/cpufreq/darkness/io_is_busy 1
            write /sys/devices/system/cpu/cpu0/cpufreq/darkness/fastlane 0
        # Big
            write /sys/devices/system/cpu/cpu2/online 1
            write /sys/devices/system/cpu/cpu2/cpufreq/scaling_min_freq 307200
            # Darkness
            write /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor "darkness"
            write /sys/devices/system/cpu/cpu2/cpufreq/darkness/go_hispeed_load 90
            write /sys/devices/system/cpu/cpu2/cpufreq/darkness/timer_rate 20000
            write /sys/devices/system/cpu/cpu2/cpufreq/darkness/min_sample_time 21000
            write /sys/devices/system/cpu/cpu2/cpufreq/darkness/max_freq_hysteresis 80000
            write /sys/devices/system/cpu/cpu2/cpufreq/darkness/timer_slack 80000
            write /sys/devices/system/cpu/cpu2/cpufreq/darkness/hispeed_freq 1324800
            write /sys/devices/system/cpu/cpu2/cpufreq/darkness/above_hispeed_delay "13000 1324800:34000"
            write /sys/devices/system/cpu/cpu2/cpufreq/darkness/target_loads "1 307200:10 556800:20 883200:30 1190400:40 1248000:50 1324800:60 1478400:70 1632000:80 1785600:90 1804800:95"
            write /sys/devices/system/cpu/cpu2/cpufreq/darkness/use_migration_notif 1
            write /sys/devices/system/cpu/cpu2/cpufreq/darkness/use_sched_load 0
            write /sys/devices/system/cpu/cpu2/cpufreq/darkness/align_windows 1
            write /sys/devices/system/cpu/cpu2/cpufreq/darkness/io_is_busy 1
            write /sys/devices/system/cpu/cpu2/cpufreq/darkness/fastlane 1
    #
    # Enable Thermal & BCL Hotplug
        write /sys/module/msm_thermal/core_control/enabled 1
        write /sys/devices/soc/soc:qcom,bcl/mode "disable"
        write /sys/devices/soc/soc:qcom,bcl/hotplug_mask 12
        write /sys/devices/soc/soc:qcom,bcl/hotplug_soc_mask 8
        write /sys/devices/soc/soc:qcom,bcl/mode "enable"
    #
    # Set Adreno GPU
        # write /sys/class/kgsl/kgsl-3d0/devfreq/adrenoboost 1
        # write /sys/class/kgsl/kgsl-3d0/default_pwrlevel 5
    #
    # Set LMK
        write /sys/module/lowmemorykiller/parameters/enable_adaptive_lmk 0
        write /sys/module/lowmemorykiller/parameters/minfree "18432,23040,27648,32256,55296,80640"
        # write /sys/module/lowmemorykiller/parameters/adj_max_shift 354
        # write /sys/module/lowmemorykiller/parameters/vmpressure_file_min 81250
        # write /sys/module/lowmemorykiller/parameters/enable_process_reclaim 1
        # write /sys/module/lowmemorykiller/parameters/min_score_adj 354
        # write /sys/module/lowmemorykiller/parameters/per_swap_size 1024
        # write /sys/module/lowmemorykiller/parameters/pressure_min 10
        # write /sys/module/lowmemorykiller/parameters/pressure_max 70
        # write /sys/module/lowmemorykiller/parameters/swap_opt_eff 30
    #
    # Set Arch Specific Power Settings
        write /sys/kernel/sched/arch_power 1
    #
    # Set Gentle Fair Sleepers Settings
        write /sys/kernel/sched/gentle_fair_sleepers 0
    #
    # CPU Input Touch Boost
        write /sys/module/msm_performance/parameters/touchboost 1
        write /sys/module/cpu_boost/parameters/input_boost_ms 50
        write /sys/module/cpu_boost/parameters/input_boost_freq "0:0 1:0 2:1324800 3:0"
    #
    # Entropy
        # write /proc/sys/kernel/random/read_wakeup_threshold 512
        # write /proc/sys/kernel/random/write_wakeup_threshold 256
    #
    # VM Tweaks
        write /proc/sys/vm/laptop_mode 1
        write /proc/sys/vm/swappiness 60
        write /proc/sys/vm/vfs_cache_pressure 100
        write /proc/sys/vm/dirty_ratio 50
        write /proc/sys/vm/dirty_background_ratio 10
        write /proc/sys/vm/dirty_expire_centisecs 500
        write /proc/sys/vm/dirty_writeback_centisecs 3000
        write /proc/sys/vm/page-cluster 0
    #
    # High Performance Snapdragon Audio
        write /sys/module/snd_soc_wcd9330/parameters/high_perf_mode 1
    #
    # Set I/O Scheduler
        setprop sys.io.scheduler fiops
        # SDA
        write /sys/block/sda/queue/scheduler fiops
        # write /sys/block/sda/queue/read_ahead_kb 512
        write /sys/block/sda/queue/iosched/slice_idle 0
        write /sys/block/sda/queue/nr_requests 256
        write /sys/block/sda/queue/iostats 0
        write /sys/block/sda/bdi/min_ratio 5
        # DM-0
        write /sys/block/dm-0/queue/scheduler fiops
        # write /sys/block/dm-0/queue/read_ahead_kb 512
        write /sys/block/dm-0/queue/iosched/slice_idle 0
        write /sys/block/dm-0/queue/nr_requests 256
        write /sys/block/dm-0/queue/iostats 0
        write /sys/block/dm-0/bdi/min_ratio 5
        # DM-1
        write /sys/block/dm-1/queue/scheduler fiops
        # write /sys/block/dm-1/queue/read_ahead_kb 512
        write /sys/block/dm-1/queue/iosched/slice_idle 0
        # write /sys/block/dm-1/queue/nr_requests 256
        write /sys/block/dm-1/queue/iostats 0
        write /sys/block/dm-1/bdi/min_ratio 5
    #
    # Set Network
        setprop net.hostname Darkness
    #
    # Misc Tweaks
        write /sys/kernel/fast_charge/force_fast_charge 1
        write /sys/module/qpnp_smbcharger/parameters/default_dcp_icl_ma 3000
        write /sys/module/qpnp_smbcharger/parameters/default_hvdcp_icl_ma 3000
        write /sys/module/qpnp_smbcharger/parameters/default_hvdcp3_icl_ma 3000
        write /sys/module/battery_current_limit/parameters/low_battery_value 1
        write /sys/module/msm_thermal/core_control/enabled 0
        write /sys/module/msm_thermal/parameters/enabled Y

on property:dev.bootcomplete=1
    trigger darkness
